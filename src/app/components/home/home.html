<div class="container home-container">

  <!-- Attendance Statistics -->
  <app-attendance-stats [records]="currentMonthRecords()"></app-attendance-stats>

  <!-- Holiday/Leave Notice -->
  <div *ngIf="todayHolidayName() || todayLeaveStatus()" class="notice-card">
    <span class="notice-icon">â„¹ï¸</span>
    <div>
      <strong>{{ todayHolidayName() || 'On Leave' }}</strong>
      <p>{{ todayHolidayName() ? 'No attendance required today' : 'You are on approved leave today' }}</p>
    </div>
  </div>

  <!-- Actions -->
  <div class="glass-card actions-card text-center">
    <h3 class="mb-4">Mark Attendance</h3>
    
    <!-- Loading state -->
    <div *ngIf="isLoading()" class="loading-state">
      <div class="spinner-small"></div>
      <p>Processing...</p>
    </div>

    <!-- Buttons -->
    <div *ngIf="!isLoading()" class="clock-buttons">
      <button class="btn btn-primary btn-large" (click)="openClockInModal()" 
        [disabled]="todayHolidayName() || todayLeaveStatus()"
        *ngIf="canClockIn()">
        â†“ CLOCK IN
      </button>
      <button class="btn btn-secondary btn-large" (click)="openClockOutModal()"
        [disabled]="todayHolidayName()"
        *ngIf="canClockOut()">
        â†‘ CLOCK OUT
      </button>
    </div>

    <!-- Mark Options - Always visible -->
    <div *ngIf="!isLoading() && canShowMarkOptions()" class="mark-options">
      <button class="btn btn-mark" (click)="openMarkModal('leave')">ğŸ“‹ Mark Leave</button>
      <button class="btn btn-mark" (click)="openMarkModal('sat-off')">ğŸ“… Sat Off</button>
      <button class="btn btn-mark" (click)="openMarkModal('sun-off')">ğŸ“… Sun Off</button>
    </div>

    <div class="mt-4">
      <button class="btn btn-report" (click)="goToReport()">
        ğŸ“Š View Monthly Reports & Export
      </button>
    </div>
  </div>

  <!-- Recent Attendance -->
  <div class="glass-card records-card">
    <h3 class="mb-3">Current Month Attendance</h3>
    <div class="table-wrapper">
      <table class="attendance-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Day</th>
            <th>In Time</th>
            <th>Out Time</th>
            <th>Duration</th>
            <th>Final Attendance</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of currentMonthRecords()" [ngClass]="getDurationStatus(record.duration).isSufficient ? 'duration-sufficient' : 'duration-insufficient'">
            <td data-label="Date">{{ record.date | date:'mediumDate' }}</td>
            <td data-label="Day">{{ record.date | date:'EEEE' }}</td>
            <td data-label="In Time">{{ record.inTime ? (record.inTime | date:'shortTime') : '-' }}</td>
            <td data-label="Out Time">{{ record.outTime ? (record.outTime | date:'shortTime') : '-' }}</td>
            <td data-label="Duration" [ngClass]="getDurationStatus(record.duration).isSufficient ? 'duration-good' : 'duration-bad'">
              {{ getDurationStatus(record.duration).displayText }}
            </td>
            <td data-label="Final Attendance" [ngClass]="getFinalAttendanceClass(record)">
              {{ getFinalAttendance(record) }}
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-edit-icon" (click)="editRecord(record)" title="Edit record">âœï¸</button>
                <button class="btn-delete-icon" (click)="deleteRecord(record.date)" title="Delete record">ğŸ—‘ï¸</button>
              </div>
            </td>
          </tr>
          <tr *ngIf="currentMonthRecords().length === 0" class="no-records">
            <td colspan="7">
              No records found for this month.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- Clock In Confirmation Modal -->
<app-modal
  [isOpen]="showClockInModal()"
  title="Clock In Confirmation"
  message="Set your clock in time:"
  confirmText="Clock In"
  cancelText="Cancel"
  (confirmed)="confirmClockIn()"
  (cancelled)="showClockInModal.set(false)"
>
  <div class="time-edit-form">
    <div class="time-input-group">
      <input type="number" min="0" max="12" placeholder="HH" class="glass-input time-number" 
        [ngModel]="clockInHour()" (ngModelChange)="clockInHour.set($event)" name="clockInHour">
      <span class="time-separator">:</span>
      <input type="number" min="0" max="59" placeholder="MM" class="glass-input time-number" 
        [ngModel]="clockInMin()" (ngModelChange)="clockInMin.set($event)" name="clockInMin">
      <select class="glass-input period-select" 
        [ngModel]="clockInPeriod()" (ngModelChange)="clockInPeriod.set($event)" name="clockInPeriod">
        <option value="AM">AM</option>
        <option value="PM">PM</option>
      </select>
    </div>
  </div>
</app-modal>

<!-- Clock Out Confirmation Modal -->
<app-modal
  [isOpen]="showClockOutModal()"
  title="Clock Out Confirmation"
  message="Set your clock out time:"
  confirmText="Clock Out"
  cancelText="Cancel"
  (confirmed)="confirmClockOut()"
  (cancelled)="showClockOutModal.set(false)"
>
  <div class="time-edit-form">
    <div class="time-input-group">
      <input type="number" min="0" max="12" placeholder="HH" class="glass-input time-number" 
        [ngModel]="clockOutHour()" (ngModelChange)="clockOutHour.set($event)" name="clockOutHour">
      <span class="time-separator">:</span>
      <input type="number" min="0" max="59" placeholder="MM" class="glass-input time-number" 
        [ngModel]="clockOutMin()" (ngModelChange)="clockOutMin.set($event)" name="clockOutMin">
      <select class="glass-input period-select" 
        [ngModel]="clockOutPeriod()" (ngModelChange)="clockOutPeriod.set($event)" name="clockOutPeriod">
        <option value="AM">AM</option>
        <option value="PM">PM</option>
      </select>
    </div>
  </div>
</app-modal>

<!-- Mark Day Modal -->
<app-modal
  [isOpen]="showMarkModal()"
  [title]="'Mark as ' + (markType() === 'leave' ? 'Leave' : markType() === 'sat-off' ? 'Saturday Off' : 'Sunday Off')"
  [message]="'Are you sure you want to mark today as ' + (markType() === 'leave' ? 'leave' : markType() === 'sat-off' ? 'Saturday Off' : 'Sunday Off') + '?'"
  confirmText="Confirm"
  cancelText="Cancel"
  (confirmed)="confirmMark()"
  (cancelled)="cancelMark()"
></app-modal>

<!-- Install Prompt Modal -->
<app-modal
  [isOpen]="showInstallPrompt()"
  title="ğŸ“± Add to Home Screen"
  message="Install Time Track on your home screen for quick access and easy attendance marking!"
  confirmText="Got it!"
  cancelText=""
  (confirmed)="dismissInstallPrompt()"
  (cancelled)="dismissInstallPrompt()"
>
  <div class="install-instructions">
    <button *ngIf="canInstall()" class="btn btn-primary btn-install" (click)="installApp()">
      â¬‡ï¸ Install App Now
    </button>
    
    <div *ngIf="!canInstall()" class="manual-install">
      <p><strong>How to install manually:</strong></p>
      <ul>
        <li>ğŸ“± <strong>Android:</strong> Tap menu (â‹®) â†’ "Add to Home screen"</li>
        <li>ğŸ <strong>iOS:</strong> Tap share (â™) â†’ "Add to Home Screen"</li>
        <li>ğŸ’» <strong>Desktop:</strong> Click install icon in address bar</li>
      </ul>
    </div>
  </div>
</app-modal>